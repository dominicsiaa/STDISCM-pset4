@page "/"
@attribute [Authorize]
@rendermode InteractiveServer

@using System.Security.Claims
@inject JWTStateProvider JWTStateProvider
@inject AuthenticationService AuthenticationService

<PageTitle>Home</PageTitle>

<h1>Hello, @Username!</h1>

<p>ID#@Id</p>
<p>You are a @Role</p>

<br />
<button @onclick="Logout">Logout</button>

@code {
	public string Username { get; set; } = string.Empty;
	public string Role { get; set; } = string.Empty;
	public string Id { get; set; } = string.Empty;

	protected override async Task OnInitializedAsync()
	{
		var response = await JWTStateProvider.GetAuthenticationStateAsync();
		var user = response.User;
		if (user.Identity.IsAuthenticated)
		{
			Username = user.Identity.Name;
			Role = user.Claims.FirstOrDefault(c => c.Type == ClaimTypes.Role)?.Value;
			Id = user.Claims.FirstOrDefault(c => c.Type == ClaimTypes.NameIdentifier)?.Value;
		}
	} 

	private async Task Logout()
	{
		await AuthenticationService.Logout();
	}
}